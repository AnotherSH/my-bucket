{
    "$schema": "https://raw.githubusercontent.com/ScoopInstaller/Scoop/refs/heads/master/schema.json",
    "version": "83e",
    "homepage": "https://pinyin.sogou.com/zhihui/",
    "license": "Freeware",
    "url": "https://pinyin.sogou.com/zhihui/#/dl.txt",
    "pre_install": [
        "Remove-Item $dir/dl.txt",
        "$url = 'https://pinyin.sogou.com/zhihui/'",
        "[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12",
        "$response = Invoke-WebRequest -Uri $url -UseBasicParsing -ErrorAction Stop",
        "$htmlContent = $response.Content",
        "$pattern = \"https:\\/\\/ime-sec\\.gtimg\\.com\\/(?<date>[\\d]{12})\\/(?<hash>[0-9A-Za-z]{32})\\/pc\\/dl\\/index\\/(?<timestamp>[\\d]{10,11})\\/sogou_pinyin_zhihui_(?<version>[\\d]+[0-9A-Za-z]+)\\.exe\"",
        "$downloadUrl = ($htmlContent | Select-String -Pattern $pattern).Matches.Groups[0].Value",
        "Invoke-WebRequest -Uri $downloadUrl -OutFile \"$dir/sogou_pinyin_zhihui.exe\""
    ],
    "installer": {
        "script": [
            "$process = Start-Process \"$dir\\sogou_pinyin_zhihui.exe\" -ArgumentList \"/D=$dir\" -PassThru",
            "$ppid = $process.Id",
            "Write-Host '已启动安装软件： '$process.Name' , 等待其安装完毕...'",
            "Wait-Process -Id $ppid",
            "Write-Host '安装软件： '$process.Name' 已关闭 ， 删除安装软件...'"
        ],
        "keep": false
    },
    "post_install": "Stop-Process -Name \"SogouImeLoader\" -Force -ErrorAction SilentlyContinue",
    "pre_uninstall": [
        "if(Get-Command Tu -ErrorAction SilentlyContinue){",
        "$process = Start-Process Tu -Verb RunAs -PassThru}",
        "elseif(Get-Command geek -ErrorAction SilentlyContinue){",
        "$process = Start-Process geek -Verb RunAs -PassThru}",
        "$ppid = $process.Id",
        "Write-Host '已启动卸载软件： '$process.Name' , 等待其关闭...'",
        "Wait-Process -Id $ppid",
        "Write-Host '卸载软件： '$process.Name' 已关闭 ， 继续关闭搜狗残留关进程...'",
        "Stop-Process -Name \"SGPicFaceTool\" -Force -ErrorAction SilentlyContinue",
        "Stop-Process -Name \"SGTool\" -Force -ErrorAction SilentlyContinue",
        "Stop-Process -Name \"SogouCloud\" -Force -ErrorAction SilentlyContinue",
        "Stop-Process -Name \"SogouImeLoader\" -Force -ErrorAction SilentlyContinue",
        "Stop-Process -Name \"SogouImeBroker\" -Force -ErrorAction SilentlyContinue",
        "if(Get-Command DelappConsole -ErrorAction SilentlyContinue){",
        "DelappConsole $dir}"
    ],
    "checkver": {
        "regex": "https:\\/\\/ime-sec\\.gtimg\\.com\\/(?<date>[\\d]{12})\\/(?<hash>[0-9A-Za-z]{32})\\/pc\\/dl\\/index\\/(?<timestamp>[\\d]{10,11})\\/sogou_pinyin_zhihui_(?<version>[\\d]+[0-9A-Za-z]+)\\.exe"
    },
    "autoupdate": {
        
    }
}
